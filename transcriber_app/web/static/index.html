<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TranscriberApp Web - Transcripci√≥n de Audio Inteligente</title>
    <meta name="description" content="Aplicaci√≥n web para grabar, transcribir y procesar audio con inteligencia artificial">
    <link rel="stylesheet" href="/static/css/github-markdown.min.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="icon" href="data:,">
    <!-- Precargar recursos importantes -->
    <!-- <link rel="preload" href="/static/recorder.js" as="script" crossorigin> -->
</head>
<body>
    <!-- Skip link para accesibilidad -->
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>

    <!-- Encabezado principal -->
    <header class="app-header">
        <h1 class="app-title">
            <span class="app-name">TranscriberApp</span>
            <span id="sessionLabel" class="session-status" aria-live="polite" title="Estado de la sesi√≥n">Sin sesi√≥n</span>
        </h1>
    </header>

    <!-- Contenido principal -->
    <main id="main-content" class="main-content">
        <!-- Configuraci√≥n de sesi√≥n -->
        <section id="sessionSetup" class="card" aria-labelledby="sessionSetupTitle">
            <h2 id="sessionSetupTitle" class="section-title">Sesi√≥n actual</h2>
            <div class="form-group">
                <label for="nombre" class="visually-hidden">Nombre de la sesi√≥n</label>
                <input type="text" 
                       id="nombre" 
                       class="form-control"
                       placeholder="ej: reunion_enero" 
                       aria-describedby="name-warning"
                       aria-required="true"
                       required>
                <small id="name-warning" class="warning-text" role="alert" hidden>
                    El nombre es obligatorio para comenzar.
                </small>
            </div>
        </section>

        <!-- Formulario de configuraci√≥n -->
        <section id="form" class="card" aria-labelledby="formTitle">
            <h2 id="formTitle" class="visually-hidden">Configuraci√≥n</h2>
            <div class="form-row-horizontal">
                <div class="form-group">
                    <label for="email">Correo electr√≥nico:</label>
                    <input type="email" 
                           id="email" 
                           class="form-control"
                           placeholder="ej: usuario@correo.com"
                           aria-required="true"
                           required>
                </div>

                <div class="form-group">
                    <label for="modo">Modo de procesamiento:</label>
                    <select id="modo" class="form-control" aria-label="Selecciona el modo de procesamiento">
                        <option value="default">Default</option>
                        <option value="tecnico">T√©cnico</option>
                        <option value="refinamiento">Refinamiento</option>
                        <option value="ejecutivo">Ejecutivo</option>
                        <option value="bullet">Bullet</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Grabaci√≥n de audio -->
        <section id="recorder" class="card recorder-section" aria-labelledby="recorderTitle">
            <h2 id="recorderTitle" class="section-title">Grabaci√≥n de audio</h2>
            
            <div class="button-group" role="group" aria-label="Controles de grabaci√≥n">
                <button id="recordBtn" class="btn btn-record" aria-label="Iniciar grabaci√≥n">
                    <span aria-hidden="true">üéôÔ∏è</span> Grabar
                </button>
                <button id="stopBtn" class="btn btn-stop" disabled aria-label="Detener grabaci√≥n">
                    <span aria-hidden="true">‚èπÔ∏è</span> Parar
                </button>
                <button id="deleteBtn" class="btn btn-delete" disabled aria-label="Borrar grabaci√≥n">
                    <span aria-hidden="true">üóëÔ∏è</span> Borrar
                </button>
                <button id="downloadBtn" class="btn btn-download" disabled aria-label="Descargar grabaci√≥n">
                    <span aria-hidden="true">üíæ</span> Descargar
                </button>
                <button id="uploadBtn" class="btn btn-upload" aria-label="Cargar archivo de audio">
                    <span aria-hidden="true">üìÇ</span> Cargar
                </button>
            </div>
            
            <input type="file" 
                   id="fileInput" 
                   accept="audio/*" 
                   class="visually-hidden" 
                   aria-label="Seleccionar archivo de audio">

            <p id="status" class="status-message" role="status" aria-live="polite">
                Esperando grabaci√≥n‚Ä¶
            </p>

            <audio id="preview" 
                   controls 
                   class="audio-preview" 
                   hidden
                   aria-label="Previsualizaci√≥n del audio grabado">
                Tu navegador no soporta el elemento de audio.
            </audio>
        </section>

        <!-- Bot√≥n de acci√≥n principal -->
        <div class="action-container">
            <button id="sendBtn" class="btn btn-primary btn-large" disabled aria-label="Procesar y enviar grabaci√≥n">
                Procesar y enviar
            </button>
        </div>

        <!-- Resultados de transcripci√≥n -->
        <section id="transcripcion" class="card collapsible-section" hidden aria-labelledby="transcriptionTitle">
            <h2 id="transcriptionTitle" class="collapsible-header">
                <button class="collapsible-toggle" aria-expanded="false" aria-controls="transcriptionContent">
                    <span class="arrow" aria-hidden="true">‚ñ∂</span>
                    Transcripci√≥n original
                </button>
            </h2>
            <div id="transcriptionContent" class="collapsible-content" hidden>
                <pre id="transcripcionTexto" class="transcription-text" tabindex="0"></pre>
            </div>
        </section>

        <!-- Resultado procesado -->
        <section id="result" class="card collapsible-section" hidden aria-labelledby="resultTitle">
            <h2 id="resultTitle" class="collapsible-header">
                <button class="collapsible-toggle" aria-expanded="false" aria-controls="resultContent">
                    <span class="arrow" aria-hidden="true">‚ñ∂</span>
                    Resultado procesado
                </button>
            </h2>
            <div id="resultContent" class="collapsible-content">
                <!-- Se llenar√° din√°micamente -->
            </div>
        </section>

        <!-- Resultados m√∫ltiples -->
        <!-- Resultados m√∫ltiples (Desuso, integrado en #result) -->
        <div id="multiResults" hidden></div>
    </main>

    <!-- Panel lateral de historial -->
    <aside id="historyPanel" class="history-panel" role="complementary" aria-label="Historial de transcripciones">
        <div class="history-header">
            <h3 class="history-title">Transcripciones</h3>
            <button id="historyClose" class="btn btn-close" aria-label="Cerrar panel de historial">
                <span aria-hidden="true">√ó</span>
            </button>
        </div>
        <div class="history-actions">
            <button id="btnNuevaSesion" class="btn btn-secondary history-reset-btn" disabled>
                Nueva sesi√≥n
            </button>
        </div>
        <nav>
            <ul id="historyList" class="history-list" role="list"></ul>
        </nav>
    </aside>

    <!-- Bot√≥n para abrir historial -->
    <button id="historyToggle" class="floating-btn history-toggle" aria-label="Abrir historial de transcripciones">
        <span class="icon" aria-hidden="true">‚ò∞</span>
    </button>

    <!-- Panel lateral del chat -->
    <aside id="chatPanel" class="chat-panel" role="complementary" aria-label="Asistente de inteligencia artificial">
        <div class="chat-header">
            <h3>Asistente IA</h3>
            <button id="chatClose" class="btn btn-close" aria-label="Cerrar panel del asistente">
                <span aria-hidden="true">√ó</span>
            </button>
        </div>

        <div id="chatMessages" class="chat-messages" role="log" aria-live="polite"></div>

        <div class="chat-input-container">
            <label for="chatInput" class="visually-hidden">Pregunta para el asistente</label>
            <textarea id="chatInput" 
                   class="form-control chat-input"
                   placeholder="Preguntar sobre la transcripci√≥n‚Ä¶"
                   aria-label="Escribe tu pregunta"
                   rows="1"></textarea>
            <button id="chatSend" class="btn btn-chat-send" aria-label="Enviar pregunta">
                Enviar
            </button>
        </div>
    </aside>

    <!-- Bot√≥n para abrir chat -->
    <button id="chatToggle" class="floating-btn chat-toggle" aria-label="Abrir asistente de inteligencia artificial">
        <span class="icon" aria-hidden="true">‚ò∞</span>
    </button>

    <!-- Overlay de carga -->
    <div id="overlayLoading" class="overlay-loading hidden" role="status" aria-label="Cargando" aria-live="assertive">
        <div class="loader" aria-hidden="true"></div>
        <span class="visually-hidden">Procesando, por favor espere...</span>
    </div>

    <!-- Modal de confirmaci√≥n para nueva sesi√≥n -->
    <div id="modalNuevaSesion" class="modal hidden">
        <div class="modal-content">
            <h3>¬øComenzar nueva sesi√≥n?</h3>
            <p>Se guardar√° la sesi√≥n actual en el historial y se limpiar√° la pantalla.</p>

            <div class="modal-buttons">
                <button id="modalCancelar" class="btn btn-secondary">Cancelar</button>
                <button id="modalConfirmar" class="btn btn-danger">S√≠, continuar</button>
            </div>
        </div>
    </div>

    <!-- Scripts al final para mejor rendimiento -->
    <script src="/static/lib/marked.min.js"></script>
    <script type="module" src="/static/js/main.js?v=024"></script>
</body>
</html>
